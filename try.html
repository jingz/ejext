<html>
    <head>
        <title>ExtJS (3.4.0) Builder [version 0.1]</title>
        <style type="text/css">
            iframe#editor:{ border: 0px;}
        </style>
        <script type="text/javascript" src="jslib/jquery-1.7.1-min.js"></script>        
        <script type="text/javascript">
            function onLoad () {
                $("#run").click(function  () {
                    var editor = document.getElementById('editor');
                    var yaml = editor.contentWindow.editor.getValue();
                    yaml = yaml.replace(/\t/img,"  ");
                    $.ajax({
                        url: "/gen",
                        type: "POST",
                        dataType: "json",
                        data: {yaml: yaml},
                        complete: function(xhr, status){
                            if(status == 'error' || !xhr.responseText){
                                console.log("error", arguments);
                            } else {
                                eval("var res = " + xhr.responseText);
                                if(res.error){
                                    alert(res.error);
                                    return;
                                }
                                var ui = res.ui_class_content;
                                var ev = res.event_class_content;
                                var renderer = document.getElementById("renderer").contentWindow;
                                renderer.eval(ui);
                                renderer.eval(ev);
                                renderer.eval("Ext.getBody().update(''); var t = new Try({renderTo: Ext.getBody()}); t.show();")
                            }
                        }
                    });
               });
            }
        </script>
    </head>
    <body onload="onLoad()">
        <div style="float:left; width: 29%; height: 100%; ">
            <button id='run'>Run</button>
            <iframe src="./editor.html" id="editor" width="100%" height="95%" frameborder="0"> </iframe>
        </div>
        <iframe src="./renderer.html" id="renderer" width="70%" height='95%'></iframe>
    </body>
</html>
